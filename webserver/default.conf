server {
  listen 5052;
  server_name www.lmwfitness.co.uk;
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  # Logging configuration
  error_log /var/log/nginx/error.log warn;
  access_log /var/log/nginx/access.log;

  # Gzip compression
  # gzip on;
  # gzip_types text/plain text/css application/javascript application/json image/svg+xml;
  # gzip_min_length 1000;

  # Security headers
  # add_header X-Content-Type-Options nosniff;
  # add_header X-Frame-Options SAMEORIGIN;
  # add_header X-XSS-Protection "1; mode=block";

  location /api/ {
    proxy_pass http://lmw-fitness-backend-service:8082/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    access_log off; 
    error_log /var/log/nginx/api_error.log debug; 
  }

  location /images/ {
    access_log off;
    error_log /var/log/nginx/images_error.log debug;
    proxy_pass http://lmw-fitness-backend-service:8082/images/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Static asset caching
  # location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
  #   root /usr/share/nginx/html;
  #   expires 30d;
  #   add_header Cache-Control "public, no-transform";
  #   try_files $uri =404;
  # }

  # Root location
  location / {
    root /usr/share/nginx/html;
    index index.html;
    try_files $uri $uri/ /index.html;
    access_log off;
    error_log /var/log/nginx/root_error.log debug;
  }

  location /assets/ {
      alias /usr/share/nginx/html/assets/;
      
      # Force correct MIME types for CSS
      location ~* \.css$ {
          add_header Content-Type text/css;
          expires 30d;
      }
      
      # Force correct MIME types for JavaScript
      location ~* \.js$ {
          add_header Content-Type application/javascript;
          expires 30d;
      }
      
      try_files $uri =404;
  }

  # Health check
  location /health {
      return 200 "healthy";
      add_header Content-Type text/plain;
  }

  # Error pages
  error_page 500 502 503 504 /50x.html;
  location = /50x.html {
    root /usr/share/nginx/html;
  }
}